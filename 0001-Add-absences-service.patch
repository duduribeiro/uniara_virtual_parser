From b975aeb95d01c3d069f0c04fd252cf22c4cd5df4 Mon Sep 17 00:00:00 2001
From: Uniara <uniara@vm-uniara>
Date: Mon, 7 Dec 2015 23:04:18 -0200
Subject: [PATCH 1/2] Add absences service

---
 lib/uniara_virtual_parser/models/.absences.rb.swp  | Bin 0 -> 12289 bytes
 lib/uniara_virtual_parser/models/absence.rb        |  11 +
 lib/uniara_virtual_parser/models/subject.rb        |   4 +-
 lib/uniara_virtual_parser/services/absences.rb     |  29 ++
 spec/fixtures/uniara_virtual/absences.html         | 442 +++++++++++++++++++++
 .../services/.grades_spec.rb.swp                   | Bin 0 -> 12288 bytes
 .../services/absences_spec.rb                      |  19 +
 7 files changed, 504 insertions(+), 1 deletion(-)
 create mode 100644 lib/uniara_virtual_parser/models/.absences.rb.swp
 create mode 100644 lib/uniara_virtual_parser/models/absence.rb
 create mode 100644 lib/uniara_virtual_parser/services/absences.rb
 create mode 100644 spec/fixtures/uniara_virtual/absences.html
 create mode 100644 spec/uniara_virtual_parser/services/.grades_spec.rb.swp
 create mode 100644 spec/uniara_virtual_parser/services/absences_spec.rb

diff --git a/lib/uniara_virtual_parser/models/.absences.rb.swp b/lib/uniara_virtual_parser/models/.absences.rb.swp
new file mode 100644
index 0000000000000000000000000000000000000000..615c82e63b8ca693e053636da848e8feee5ee751
GIT binary patch
literal 12289
zcmeI%!D_-V9LMpv<6vy)3&eTWR5#e!qle+CyUIT{V4>QQwjPB&n-8<caIIyqOTn}G
z2L5eG{?PnB$J9n&t55wgdsoePX&>EKpOmT(sd)KY>3<*h)0<jPU6(n3dnY<^y7FQr
z+vR3i6gs|s&2&ARW9q9~vP~hrblzmC?b+GqiOWhOwseQBD`(#JACw&gf);p+-xl*|
z@;cU|VH~ss;SoRp0R#|0009IL2vMLa2I|rTe`sp(uR^pSGXe-8fB*srAb<b@2q1s}
v0{1E)iBdn$N?n?2|Npml0N44w1|}B*2q1s}0tg_000IagfB*sk3OxP-hWa^&

literal 0
HcmV?d00001

diff --git a/lib/uniara_virtual_parser/models/absence.rb b/lib/uniara_virtual_parser/models/absence.rb
new file mode 100644
index 0000000..7d89668
--- /dev/null
+++ b/lib/uniara_virtual_parser/models/absence.rb
@@ -0,0 +1,11 @@
+module UniaraVirtualParser
+	module Models
+		class Absence
+			attr_reader :frequency, :total
+
+			def initialize(attribuites={})
+				@frequency = 		:attribuites.fetch :frequency
+				@total = 			:attribuites.fetch :total
+		end
+	end
+end
diff --git a/lib/uniara_virtual_parser/models/subject.rb b/lib/uniara_virtual_parser/models/subject.rb
index 1032894..76290e7 100644
--- a/lib/uniara_virtual_parser/models/subject.rb
+++ b/lib/uniara_virtual_parser/models/subject.rb
@@ -2,7 +2,8 @@ module UniaraVirtualParser
   module Models
     class Subject
       attr_reader :name, :first_bimester, :second_bimester, :third_bimester,
-                  :fourth_bimester, :substitutive, :average, :recovery, :status
+                  :fourth_bimester, :substitutive, :average, :recovery, :status,
+	  			  :absences
 
       def initialize(attributes = {})
         @name             = attributes.fetch :name
@@ -14,6 +15,7 @@ module UniaraVirtualParser
         @average          = attributes.fetch :average
         @recovery         = attributes.fetch :recovery
         @status           = attributes.fetch :status
+		@absences		  = attributes.fetch :absences
       end
     end
   end
diff --git a/lib/uniara_virtual_parser/services/absences.rb b/lib/uniara_virtual_parser/services/absences.rb
new file mode 100644
index 0000000..2b6b6ca
--- /dev/null
+++ b/lib/uniara_virtual_parser/services/absences.rb
@@ -0,0 +1,29 @@
+module UniaraVirtualParser
+	module Services
+		module Absences
+		def Absences(token)
+			response = Client.get_with_token('/alunos/consultas/faltas',token)
+			parse_absences response.body
+		end
+
+		private 
+
+		def parse_absences(html)
+			doc = Nokogiri::HTML(html)
+			absences = []
+			subjects = []
+			
+			doc.css('div#conteudo ^table tr').each_with_index do |absence,index|
+				next if index.zero?
+				absences = Models::Absence.new(
+					frequency: 		absence.css('td:nth-child(2)').text,
+					total:			absence.css('td:nth-child(3)').text
+				)
+				subjects << Models::Subject.new(absence:absences)
+			end
+			subjects
+		end
+		end
+	end
+end
+
diff --git a/spec/fixtures/uniara_virtual/absences.html b/spec/fixtures/uniara_virtual/absences.html
new file mode 100644
index 0000000..8a5787b
--- /dev/null
+++ b/spec/fixtures/uniara_virtual/absences.html
@@ -0,0 +1,442 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
+<html>
+	<head>
+	    <title>Uniara Virtual - Acadêmico > Consultas > Registro de Faltas</title>
+	    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+	    <meta name="Author" content="Weverton Velludo - wvelludo@uniara.com.br">
+	    <meta name="Robots" CONTENT="noindex,nofollow">
+		<link type="image/x-icon" rel="shortcut icon" href="http://www.uniara.com.br/favicon.ico" />
+	    <link rel="stylesheet" href="http://www.uniara.com.br/barra_navegacao.css" type="text/css">
+		<script type="text/javascript" src="http://www.uniara.com.br/barra_navegacao_virtual.js.php"></script>
+	    <link href="/templates/alunos/css.css" rel="stylesheet" type="text/css">
+    
+		<script type="text/javascript" src="/templates/alunos/ferramentas/js/jquery.js"></script>
+        <script type="text/javascript" src="/templates/alunos/ferramentas/js/jquery.jqDock.min.js"></script>
+        <script type="text/javascript" src="/templates/alunos/ferramentas/js/jquery-ui-1.8.15.custom.min.js"></script>
+        <link type="text/css" href="/templates/alunos/ferramentas/css/ui-lightness/jquery-ui-1.8.15.custom.css" rel="stylesheet" />
+    
+	    <script src="/templates/js/generico.js" type="text/javascript"></script>
+	    <script src="/templates/alunos/js/generico.js" type="text/javascript"></script>
+	    <script src="/templates/js/mascaraHellas.js"></script>
+		<script type="text/javascript">
+			var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
+			document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
+		</script>
+		<script type="text/javascript">
+			try {
+				var pageTracker = _gat._getTracker("UA-9447697-1");
+				pageTracker._trackPageview();
+			} catch(err) {}
+		</script>
+	    <script type="text/javascript">
+	    
+			function tempolimite() {
+				if (atual != 0) {
+					document.getElementById('tlimite').innerHTML = "Tempo restante: <b>" + atual + "</b> min."
+					if (atual==2) {
+						if (pagina != "/index.php") {
+							document.getElementById('limite').innerHTML = "<table width='99%' align='center' border='0' cellpadding='3' cellspacing='1' bgcolor='#000000'><tr bgcolor='#0f3b4d'><td align='center'><font color='#FFFFFF'><b>ATENÇÃO</b></font></td></tr><tr bgcolor='#47778b'><td align=center><b>Sua sessão está chegando ao fim, salve as informações para evitar perda de dados.<BR>Você tem menos de 2 minutos para verificar e postar seus dados.</b></td></tr></table><BR>"
+							document.getElementById('limite2').innerHTML = "<BR><table width='99%' align='center' border='0' cellpadding='3' cellspacing='1' bgcolor='#000000'><tr bgcolor='#0f3b4d'><td align='center'><font color='#FFFFFF'><b>ATENÇÃO</b></font></td></tr><tr bgcolor='#47778b'><td align=center><b>Sua sessão está chegando ao fim, salve as informações para evitar perda de dados.<BR>Você tem menos de 2 minutos para verificar e postar seus dados.</b></td></tr></table><BR>"
+						}
+					}
+					atual-=1;
+				} else {
+					window.location="/login/";
+				}
+				setTimeout("tempolimite()",60000);
+    		}
+    		
+	        // Institucional
+	        var menu1=new Array()
+	        menu1[0]='<div class=dropmenu style="width:100%">&nbsp;<b>Informações</b></div>'
+	        menu1[1]='<a href="/alunos/institucional/reitor/" class=dropmenul target=_self>Palavra do Reitor</a>'
+	        menu1[2]='<a href="http://www.uniara.com.br/institucional/a_uniara.php" class=dropmenul target=_blank>A Uniara</a>'
+	        menu1[3]='<a href="http://www.uniara.com.br/atividades_culturais/" class=dropmenul target=_blank>Atividades Culturais</a>'
+	        menu1[4]='<a href="http://www.uniara.com.br/esporte/" class=dropmenul target=_blank>Esporte</a>'
+	        menu1[5]='<a href="http://www.uniara.com.br/revistauniara/default.asp" class=dropmenul target=_blank>Revista Uniara</a>'
+	        menu1[6]='<a href="http://www.uniara.com.br/parque_do_basalto/" class=dropmenul target=_blank>Parque do Basalto</a>'
+	        menu1[7]='<a href="http://www.uniara.com.br/ageuniara/" class=dropmenul target=_blank>Ageuniara</a>'
+	        menu1[8]='<a href="http://www.uniara.com.br/guia_turistico/" class=dropmenul target=_blank>Guia de Araraquara</a>'
+	        menu1[9]='<a href="http://www.uniara.com.br/visitavirtual/" class=dropmenul target=_blank>Visita Virtual</a>'
+	
+	        // Uniara Virtual
+	        var menu2=new Array()
+	        menu2[0]='<div class=dropmenu style="width:100%">&nbsp;<b>Informações</b></div>'
+	        menu2[1]='<a href="/alunos/virtual/apresentacao/" class=dropmenul target=_self>Apresentação</a>'
+	        menu2[2]='<div class=dropmenu style="width:100%">&nbsp;<b>Contato</b></div>'
+	        menu2[3]='<a href="/alunos/contato/criticas/" class=dropmenul target=_self>Críticas e Sugestões</a>'
+			menu2[4]='<div class=dropmenu style="width:100%">&nbsp;<b>Serviços</b></div>'
+			menu2[5]='<a href="/alunos/servicos/senha/" class=dropmenul target=_self>Alteração de Senha</a>'
+			
+	        // Academico
+	        var menu3=new Array()
+	        menu3[0]='<div class=dropmenu style="width:100%">&nbsp;<b>Informações</b></div>'
+	        menu3[1]='<a href="/alunos/informacoes/apresentacao/" class=dropmenul target=_self>Apresentação</a>'
+	        menu3[2]='<a href="/alunos/informacoes/duvidas/" class=dropmenul target=_self>Dúvidas Freqüentes</a>'
+	        //menu3[3]='<a href="#" onclick="javascript:guia();" class=dropmenul target=_self>Guia do Aluno</a>'
+	        menu3[4]='<a href="http://www.uniara.com.br/graduacao/eng_computacao/" class=dropmenul target=_blank>Meu Curso</a>'
+	        menu3[5]='<div class=dropmenu style="width:100%">&nbsp;<b>Consultas</b></div>'
+	        menu3[6]='<a href="/alunos/consultas/disciplinas/" class=dropmenul target=_self>Disciplinas Matriculadas</a>'
+	        menu3[7]='<a href="/alunos/consultas/dados/" class=dropmenul target=_self>Dados Cadastrais</a>'
+	        menu3[8]='<a href="/alunos/consultas/horario/" class=dropmenul target=_self>Horário de Aula</a>'
+	        menu3[9]='<a href="/alunos/consultas/atividades/" class=dropmenul target=_self>Atividades Complementares</a>'
+	        menu3[10]='<a href="/alunos/consultas/historico/" class=dropmenul target=_self>Histórico Escolar</a>'
+	        menu3[11]='<a href="/alunos/consultas/arquivos/" class=dropmenul target=_self>Arquivos Disponíveis</a>'
+	        menu3[12]='<a href="/alunos/consultas/requerimentos/" class=dropmenul target=_self>Requerimentos</a>'
+	        menu3[13]='<a href="/alunos/consultas/planoensino/" class=dropmenul target=_self>Planos de Ensino das Disciplinas</a>'
+	        menu3[14]='<a href="/alunos/consultas/calendario/" class=dropmenul target=_self>Calendário Acadêmico</a>'
+	        menu3[15]='<a href="/alunos/consultas/notas/" class=dropmenul target=_self>Registro de Notas</a>'
+	        menu3[16]='<a href="/alunos/consultas/faltas/" class=dropmenul target=_self>Registro de Faltas</a>'
+
+							
+
+	        //menu3[17]='<a href="/alunos/consultas/mensagens/" class=dropmenul target=_self>Caixa de Mensagens</a>'
+
+	        menu3[18]='<div class=dropmenu style="width:100%">&nbsp;<b>Serviços</b></div>'
+	        menu3[19]='<a href="/alunos/servicos/dados/" class=dropmenul target=_self>Alteração de Cadastro</a>'
+	        menu3[20]='<a href="/alunos/servicos/biblioteca/" class=dropmenul target=_self>Biblioteca</a>'
+	        menu3[21]='<a href="/alunos/servicos/requerimentos/" class=dropmenul target=_self>Solicitação de Requerimentos</a>'
+	        menu3[22]='<a href="/alunos/servicos/matricula/" class=dropmenul target=_self>Matrícula On-line</a>'			
+	        menu3[23]='<div class=dropmenu style="width:100%">&nbsp;<b>Contato</b></div>'
+	        menu3[24]='<a href="/alunos/contato/central/" class=dropmenul target=_self>Central de Atendimento</a>'				
+				        menu3[25]='<a href="/alunos/servicos/coordenador/" class=dropmenul target=_self>Fale com seu coordenador</a>'
+							
+	
+	        // Financeiro
+	        var menu4=new Array()
+	        menu4[0]='<div class=dropmenu style="width:100%">&nbsp;<b>Informações</b></div>'
+	        menu4[1]='<a href="/alunos/financeiro/apresentacao/" class=dropmenul target=_self>Apresentação</a>'
+	        menu4[2]='<a href="/alunos/financeiro/duvidas/" class=dropmenul target=_self>Dúvidas Freqüentes</a>'
+	        menu4[3]='<div class=dropmenu style="width:100%">&nbsp;<b>Consultas</b></div>'
+	        menu4[4]='<a href="/alunos/financeiro/dados/" class=dropmenul target=_self>Dados Financeiros</a>'
+	        menu4[5]='<a href="/alunos/financeiro/mensalidades/" class=dropmenul target=_self>Mensalidades Atrasadas</a>'
+	        menu4[6]='<div class=dropmenu style="width:100%">&nbsp;<b>Serviços</b></div>'
+	        menu4[7]='<a href="/alunos/financeiro/segundavia/" class=dropmenul target=_self>Segunda via de Carnê</a>'
+	        menu4[8]='<div class=dropmenu style="width:100%">&nbsp;<b>Contato</b></div>'
+	        menu4[9]='<a href="/alunos/contato/financeiro/" class=dropmenul target=_self>Tesouraria</a>'
+	
+	        // Fora de Sala
+	        var menu5=new Array()
+	        menu5[0]='<a href="/alunos/foradesala/vagasestagio/" class=dropmenul target=_self>Estágios e Oportunidades</a>'
+	        menu5[1]='<a href="http://neuvoo.com.br/pt" class=dropmenul target=_self>Oportunidades de Emprego</a>'
+			
+	        menu5[2]='<div class=dropmenu style="width:100%">&nbsp;<b>Entretenimento</b></div>'
+	        //menu5[2]='<a href="/alunos/foradesala/enquetes/" class=dropmenul target=_self>Enquetes</a>'
+	        menu5[3]='<a href="http://www.dceuniara.com.br" class=dropmenul target=_blank>Site DCE</a>'
+	        menu5[4]='<a href="/alunos/foradesala/calendario/" class=dropmenul target=_self>Agenda</a>'
+	        menu5[5]='<div class=dropmenu style="width:100%">&nbsp;<b>Setores de Apoio ao Aluno</b></div>'
+	        menu5[6]='<a href="/alunos/foradesala/relacionamento/" class=dropmenul target=_self>Setor de Relacionamento</a>'
+	        menu5[7]='<a href="/alunos/foradesala/estagios/" class=dropmenul target=_self>Divisão de Estágios</a>'
+	        menu5[8]='<a href="/alunos/foradesala/central/" class=dropmenul target=_self>Central de Atendimento</a>'
+	        menu5[9]='<a href="/alunos/foradesala/biblioteca/" class=dropmenul target=_self>Biblioteca</a>'
+		</script>
+		<script src="/templates/js/menu.js" type="text/javascript"></script>
+	</head>
+	<body onLoad="barranavegacao();" bgcolor="#ffffff" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
+		<div id="barranavegacao"></div>
+		<table width="770" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+			<tr>
+				<td height="62">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="25" background="/templates/alunos/imagens/t1.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td background="/templates/alunos/imagens/t2.gif" align="center">
+								<img src="/templates/alunos/imagens/trans.gif"><BR>
+							</td>
+							<td width="25" background="/templates/alunos/imagens/t3.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="50">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="25" background="/templates/alunos/imagens/t1.gif" valign="bottom"><img src="/templates/alunos/imagens/t4.gif"><BR></td>
+							<td width="68" background="/templates/alunos/imagens/t5.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="8"><img src="/templates/alunos/imagens/t21.gif"><BR></td>
+							<td width="111" background="/templates/alunos/imagens/t22.gif" align="center">
+								<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+									<tr>
+										<td height="30" colspan="2"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+									</tr>
+									<tr>
+										<td align="center">
+											<font color="#FFFFFF" size="1" style="font:10px"><b>UNIARA VIRTUAL</b></font>
+										</td>
+										<td width="4"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+									</tr>
+								</table>
+							</td>
+							<td width="9"><img src="/templates/alunos/imagens/t23.gif"><BR></td>
+							<td width="8" bgcolor="#5E8EA2"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td bgcolor="#5E8EA2"><font color="#FFFFFF" size="6">ALUNO</font></td>
+							<td width="5"><img src="/templates/alunos/imagens/t8.gif"><BR></td>
+							<td width="134" background="/templates/alunos/imagens/t9.gif">
+								<table width="100%" height="50" border="0" align="center" cellpadding="0" cellspacing="0">
+									<tr>
+										<td><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+									</tr>
+									<tr>
+										<td height="16" align="center">
+					                        <table width="98%" height="16" border="0" align="CENTER" cellpadding="0" cellspacing="0">
+					                        	<form name="redirect" action="#">
+					                            <tr>
+					                                <td align="center">
+														<div id="tlimite">
+										               		<script>
+										               			var atual = 120;
+										               			var pagina = "faltas.php"; 
+										               			tempolimite();
+										               		</script>
+									               		</div>
+					                                </td>
+					                            </tr>
+					                            </form>
+					                        </table>
+										</td>
+									</tr>
+								</table>
+							</td>
+							<td width="4"><img src="/templates/alunos/imagens/t10.gif"><BR></td>
+							<td width="25" background="/templates/alunos/imagens/t3.gif" valign="bottom"><img src="/templates/alunos/imagens/t6.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="46">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="9"><img src="/templates/alunos/imagens/t11.gif"><BR></td>
+							<td width="152" bgcolor="#5E8EA2"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="51"><img src="/templates/alunos/imagens/t12.gif"><BR></td>
+							<td>
+								<table width="400" height="18" border="0" cellpadding="0" cellspacing="0">
+									<tr>
+										<td background="/templates/alunos/imagens/local.jpg">
+											<font color="#737373"><b>&nbsp;&nbsp;&nbsp;&nbsp;Acadêmico > Consultas > Registro de Faltas</b></font>
+										</td>
+									</tr>
+								</table>	
+							</td>
+							<td width="12"><img src="/templates/alunos/imagens/t13.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="20">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="3" background="/templates/alunos/imagens/s1.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="151" bgcolor="#5E8EA2"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="9"><img src="/templates/alunos/imagens/t14.gif"><BR></td>
+							<td width="49">&nbsp;</td>
+							<td width="4"><img src="/templates/alunos/imagens/t15.gif"><BR></td>
+							<td bgcolor="#5E8EA2">
+                                <table width="98%" height="100%" border="0" align="CENTER" cellpadding="0" cellspacing="0">
+                                    <tr>
+                                        <td align="left">
+                                        	<font color="#FFFFFF">
+                                            	<b>Bom Dia, EZEQUIEL MESSORE</b>
+                                            </font>
+                                        </td>
+                                        <td width="110" align="right">
+                                            <font color="#FFFFFF" size="2">
+                                        		<b>|</b>
+                                        	</font>
+                                        	<font color="#FFFFFF" size="1">
+                                        	    &nbsp;
+                                        		<b>Acesso nº 1464</b>
+                                        	</font>
+                                        </td>
+                                        <td width="5">
+                                        	<img src="/templates/alunos/imagens/trans.gif"><BR>
+                                        </td>
+                                    </tr>
+                                </table>
+							</td>
+							<td width="51"><a href="/login/"><img src="/templates/alunos/imagens/sair.gif"></a><BR></td>
+							<td width="3" background="/templates/alunos/imagens/s2.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="22">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="3" background="/templates/alunos/imagens/s1.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="150" bgcolor="#5E8EA2"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="8"><img src="/templates/alunos/imagens/t16.gif"><BR></td>
+							<td><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="1" bgcolor="#929292"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="3" background="/templates/alunos/imagens/s2.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="26">
+					<table width="100%" height="26" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="3" background="/templates/alunos/imagens/s1.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="150" bgcolor="#47778B" align="center"><a href="/alunos/index/" class="menu">home</a></td>
+							<td bgcolor="#B1B1B1">
+		                        <table height="26" border="0" align="CENTER" cellpadding="0" cellspacing="0">
+		                            <tr>
+		                               
+                                       
+                                       
+                                        <td width="103" align="center"><a href=# class="menu" onMouseOver="return dropdownmenu(this, event, menu1, '150px')" onMouseout="delayhidemenu()">institucional</a><BR></td>
+		                                <td width="22" align="center"><font size="2" color="#ffffff"><b>|</b></font><BR></td>
+		                                <td width="103" align="center"><a href=# class="menu" onMouseOver="return dropdownmenu(this, event, menu2, '150px')" onMouseout="delayhidemenu()">uniara virtual</a><BR></td>
+		                                <td width="22" align="center"><font size="2" color="#ffffff"><b>|</b></font><BR></td>
+		                                <td width="103" align="center"><a href=# class="menu" onMouseOver="return dropdownmenu(this, event, menu3, '203px')" onMouseout="delayhidemenu()">acadêmico</a><BR></td>
+		                                <td width="22" align="center"><font size="2" color="#ffffff"><b>|</b></font><BR></td>
+		                                <td width="103" align="center"><a href=# class="menu" onMouseOver="return dropdownmenu(this, event, menu4, '150px')" onMouseout="delayhidemenu()">financeiro</a><BR></td>
+		                                <td width="22" align="center"><font size="2" color="#ffffff"><b>|</b></font><BR></td>
+		                                <td width="103" align="center"><a href=# class="menu" onMouseOver="return dropdownmenu(this, event, menu5, '170px')" onMouseout="delayhidemenu()">fora de sala</a><BR></td>
+		                            </tr>
+		                        </table>
+							</td>
+							<td width="1" bgcolor="#929292"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="3" background="/templates/alunos/imagens/s2.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td valign="top">
+            		<!-- Centro da Página -->
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="3" background="/templates/alunos/imagens/s1.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="150" valign="top">
+								<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+									<tr>
+										<td bgcolor="#5E8EA2" valign="top" align="center">
+					                    	<BR>									
+					                    						        				<a href="/redir/41/" target="_blank"><img src="/arquivos/banners/673d343611964aec8f9dfeb4b172d9cd.jpg" border="0"></a>											<BR><img src="/templates/imagens/trans.gif" height="6"><BR>
+											<a href="/redir/32/" target="_blank"><img src="/arquivos/banners/a36a232bf3d5402b2912e5cb611e8269.jpg" border="0"></a>											<BR><img src="/templates/imagens/trans.gif" height="6"><BR>						
+											<a href="/redir/60/" target="_blank"><img src="/arquivos/banners/799799a12e9190d6a7a0d0114287ac81.png" border="0"></a>											<BR><img src="/templates/imagens/trans.gif" height="6"><BR>
+											<a href="/redir/47/" target="_blank"><img src="/arquivos/banners/f19d981b9ea9470fb99784931184f83c.jpg" border="0"></a>											<BR><img src="/templates/imagens/trans.gif" height="6"><BR>
+																					</td>
+									</tr>
+									<tr>
+										<td height="8"><img src="/templates/alunos/imagens/t17.gif"><BR></td>
+									</tr>
+								</table>
+							</td>
+							<td valign="top">
+								<table width="96%" align="center">
+									<tr>
+										<td valign="top">
+<BR>
+<div id="limite"></div>
+<div id='conteudo'></div>
+			<table width="99%" border="0" align="center" cellpadding="3" cellspacing="1" bgcolor="#000000">
+				<tr bgcolor="#9999CC"> 
+						<td bgcolor="#47778b"><b>Disciplina</b></td>
+						<td valign="top" align="center" bgcolor="#47778b"><b>C. H.</b></td>
+						<td valign="top" align="center" bgcolor="#47778b"><b>Frequência (%)</b></td>
+						<td valign="top" align="center" bgcolor="#47778b"><b>Faltas</b></td>
+						<td valign="top" align="center" bgcolor="#47778b"><b>Atualização</b></td>
+				</tr>
+				
+					<tr bgcolor=#FFFFFF>
+						<!--td><a href="#" onmouseover="toolTip('<table align=left border=0 cellpadding=3 cellspacing=1 bgcolor=#000000><tr><td bgcolor=f5f5f5><table align=center border=0 cellpadding=3 cellspacing=1 bgcolor=#000000><tr><td bgcolor=#47778b colspan=9><b>REDES DE COMPUTADORES</b></td></tr><tr bgcolor=#bdd6e0><td align=center><b>Data</b></td><td align=center><b>Faltas</b></td></tr>     <tr bgcolor=#FFFFFF> <td align=center>30/09/2015</td><td align=center>2</td> </tr> </table></td></tr></table>',this)"><span id="toolTipBox" width="440"></span>REDES DE COMPUTADORES</a></td-->
+						<td><a href="/alunos/consultas/faltasdetalhes/0cgbPZWQdvGAnl4qVfYj7cBwfT5j3ydZUBzJpdvmJw-S-RGEfiOMq0qYYFZt7xhq8_QJO9MrhVcw2821PVX9MQ">REDES DE COMPUTADORES</a></td>
+						<td align="center">80h</td>
+						<td align="center">98%</td>
+						<td align="center">2</td>
+						<td align="center">30/11/2015</td>
+					</tr>
+					
+			</table>
+			<BR>
+		   	<center>
+				<b>Atenção:</b> Registro de faltas para simples conferência, quantidade de faltas sujeito a alteração,<BR>caso professor entregue listas de presença posteriormente da data da atualização.
+				<BR><BR>
+				Acesse <b>"<a href="/alunos/consultas/historico/">Histórico Escolar</a>"</b> para consultar disciplinas já encerradas.
+			</center>
+		   	<BR>
+			<div id="limite2"></div>										</td>
+									</tr>
+								</table>
+							</td>
+							<td width="1" bgcolor="#929292"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="3" background="/templates/alunos/imagens/s2.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+						</tr>
+					</table>            				<!-- Fim Centro da Página -->
+
+				</td>
+			</tr>
+			<tr>
+				<td height="20">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="3" background="/templates/alunos/imagens/s1.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="1" bgcolor="#929292"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="1" bgcolor="#929292"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="3" background="/templates/alunos/imagens/s2.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="1">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="3" background="/templates/alunos/imagens/s1.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="2" bgcolor="#929292"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td bgcolor="#000000"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="2" bgcolor="#929292"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td width="3" background="/templates/alunos/imagens/s2.gif"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="84">
+					<table width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0">
+						<tr>
+							<td width="109"><img src="/templates/alunos/imagens/t18.jpg"><BR></td>
+							<td width="20" background="/templates/alunos/imagens/t19.jpg"><img src="/templates/alunos/imagens/trans.gif"><BR></td>
+							<td background="/templates/alunos/imagens/t19.jpg">
+								<font face="verdana" size="1" color="#4c4c4c">
+									<BR>
+									<B>Copyright © 2015 Centro Universitário de Araraquara - UNIARA.</B><BR>
+									Todos os direitos reservados - UV.2.1-WV - FALTAS-2.0-BETA-1-WV.<BR><BR>&nbsp;
+								</font>
+							</td>
+							<td width="15"><img src="/templates/alunos/imagens/t20.jpg"><BR></td>
+						</tr>
+					</table>
+				</td>
+			</tr>
+			<tr>
+				<td height="5">
+					<img src="/templates/alunos/imagens/trans.gif"><BR>
+				</td>
+			</tr>
+		</table>
+	</body>
+</html>
+<script type="text/javascript">
+
+  var _gaq = _gaq || [];
+  _gaq.push(['_setAccount', 'UA-27812250-1']);
+  _gaq.push(['_setDomainName', 'uniara.com.br']);
+  _gaq.push(['_trackPageview']);
+
+  (function() {
+    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
+    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
+    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
+  })();
+
+</script>
+
diff --git a/spec/uniara_virtual_parser/services/.grades_spec.rb.swp b/spec/uniara_virtual_parser/services/.grades_spec.rb.swp
new file mode 100644
index 0000000000000000000000000000000000000000..96fee7d686ac8f2a7c332efb3b9775a072b2cc6e
GIT binary patch
literal 12288
zcmeI2F>ljQ5XWE3T&RGZBORPb!A?shq)1eXN`)ekrlK?>(X)MtEjhOP-gDZjDiW$h
zg_szb5i?(aEju$4Gw>zg96NyyRLta_^nbQ>=eu{m(f+%QUb_Pi>`g&yRfx$~>^)z8
zB37>nk;S1@G7nt6#-n@xl=`B`awaboO7IbklCF$`#A&4|989}8MNWSlDwD~mpGu`s
zIXXq}Zy{9U&_nGEmGn{f^Hf{8S09<9Oke>Ctcd#?>y5R_UAT4gU;*dnk(mG!U;<2l
z2`~XBzyz4UViPdwlK4pomPxlsOQq<-iwQ6RCcp%k025#WOn?b60Vco%m;e*_PY6g~
zh_w|VE=c+R|NI-kj~haKCw(S;B7GpeChd{7NZ+mtaZWlSjY)S%U+Ddhr1zwEq_?Cu
zq`dAc5-%pe1egF5U;<2l2`~XBzyz286POaf*cSlB{`>mp-Q|0FIwqg9sTQVZJHmKq
zf|_j-z(ZKyq++vmIdKpwZR}W%aF$$YJ?gY~+xyR+wk8*o^DgYb&USaV+iABd^D?0U
zYk<ZJP=g5&yd*Xl8%PFF7`CA_Y=ew_a8(!&i$tlEJb|Oo1W+8+0zVP+y0eLAhc!uG
zp~+NSZE7P;rs3fhY&05ma1;NeSvH%y!w2CpC1bTxVhGGAs?=<<m-}@HXh)@+aC%mo
zHw4fobE(N;hT2q{Lo{`$1jeLI$0=v9i;-+E8QHFKWR%5;c4%asMMi2TPV$}l%&WRM
zNEGIi%?61uFFtjo*Wi@Q?%GqKi+<mWq}Fy30n3$UBx4KC$`@yOV3jFTTzS!X<ngp<
q(QB0WS%k1(THr<bTv+LQg@t}^>Yx`QA33B$TDd{KA7GTCvcxat(hm3l

literal 0
HcmV?d00001

diff --git a/spec/uniara_virtual_parser/services/absences_spec.rb b/spec/uniara_virtual_parser/services/absences_spec.rb
new file mode 100644
index 0000000..7e0b03f
--- /dev/null
+++ b/spec/uniara_virtual_parser/services/absences_spec.rb
@@ -0,0 +1,19 @@
+require 'spec_helper'
+
+module UniaraVirtualParser
+  module Services
+    describe Absences do
+      describe '.absences' do
+        let(:absences) { described_class.absences 'batman' }
+        before do
+          stub_request(:get,"http://virtual.uniara.com.br/alunos/consultas/faltas/").
+            to_return (status: => 200, body: uniara_virtual_fixture("absences.html").read, headers:{})
+        end
+        it 'fetches the content of uniara virtual and brings the array with absences' do
+          expect (absences.first.frequency).to eq "100%"
+          expect(absences.length).to eq 14
+        end
+      end
+    end
+  end
+end
-- 
2.1.4

