From 1d6f4374543a6381a4c18f641f19a2409d428396 Mon Sep 17 00:00:00 2001
From: Ezequiel Messore <ezequielmessore.developer@gmail.com>
Date: Tue, 8 Dec 2015 00:15:46 -0200
Subject: [PATCH 2/2] Gerando segundo path

---
 lib/uniara_virtual_parser.rb                        |   3 +++
 lib/uniara_virtual_parser/models/absence.rb         |   7 ++++---
 lib/uniara_virtual_parser/models/subject.rb         |  20 ++++++++++----------
 lib/uniara_virtual_parser/services/absences.rb      |   5 ++---
 .../services/.grades_spec.rb.swp                    | Bin 12288 -> 0 bytes
 .../uniara_virtual_parser/services/absences_spec.rb |  14 ++++++++------
 6 files changed, 27 insertions(+), 22 deletions(-)
 delete mode 100644 spec/uniara_virtual_parser/services/.grades_spec.rb.swp

diff --git a/lib/uniara_virtual_parser.rb b/lib/uniara_virtual_parser.rb
index 68a76e7..01c4d5a 100644
--- a/lib/uniara_virtual_parser.rb
+++ b/lib/uniara_virtual_parser.rb
@@ -3,11 +3,14 @@ require 'nokogiri'
 require 'uniara_virtual_parser/version'
 require 'uniara_virtual_parser/client'
 require 'uniara_virtual_parser/models/subject'
+require 'uniara_virtual_parser/models/absence'
 require 'uniara_virtual_parser/services/login'
 require 'uniara_virtual_parser/services/grades'
+require 'uniara_virtual_parser/services/absences'
 
 include UniaraVirtualParser::Services::Login
 include UniaraVirtualParser::Services::Grades
+include UniaraVirtualParser::Services::Absences
 
 module UniaraVirtualParser
   #
diff --git a/lib/uniara_virtual_parser/models/absence.rb b/lib/uniara_virtual_parser/models/absence.rb
index 7d89668..52539bb 100644
--- a/lib/uniara_virtual_parser/models/absence.rb
+++ b/lib/uniara_virtual_parser/models/absence.rb
@@ -3,9 +3,10 @@ module UniaraVirtualParser
 		class Absence
 			attr_reader :frequency, :total
 
-			def initialize(attribuites={})
-				@frequency = 		:attribuites.fetch :frequency
-				@total = 			:attribuites.fetch :total
+			def initialize(attributes={})
+				@frequency = 		attributes.fetch :frequency, nil
+				@total = 			  attributes.fetch :total, nil
+      end
 		end
 	end
 end
diff --git a/lib/uniara_virtual_parser/models/subject.rb b/lib/uniara_virtual_parser/models/subject.rb
index 76290e7..30bb973 100644
--- a/lib/uniara_virtual_parser/models/subject.rb
+++ b/lib/uniara_virtual_parser/models/subject.rb
@@ -6,16 +6,16 @@ module UniaraVirtualParser
 	  			  :absences
 
       def initialize(attributes = {})
-        @name             = attributes.fetch :name
-        @first_bimester   = attributes.fetch :first_bimester
-        @second_bimester  = attributes.fetch :second_bimester
-        @third_bimester   = attributes.fetch :third_bimester
-        @fourth_bimester  = attributes.fetch :fourth_bimester
-        @substitutive     = attributes.fetch :substitutive
-        @average          = attributes.fetch :average
-        @recovery         = attributes.fetch :recovery
-        @status           = attributes.fetch :status
-		@absences		  = attributes.fetch :absences
+        @name             = attributes.fetch :name, nil
+        @first_bimester   = attributes.fetch :first_bimester, nil
+        @second_bimester  = attributes.fetch :second_bimester, nil
+        @third_bimester   = attributes.fetch :third_bimester, nil
+        @fourth_bimester  = attributes.fetch :fourth_bimester, nil
+        @substitutive     = attributes.fetch :substitutive, nil
+        @average          = attributes.fetch :average, nil
+        @recovery         = attributes.fetch :recovery, nil
+        @status           = attributes.fetch :status, nil
+		    @absences		      = attributes.fetch :absences, nil
       end
     end
   end
diff --git a/lib/uniara_virtual_parser/services/absences.rb b/lib/uniara_virtual_parser/services/absences.rb
index 2b6b6ca..18933ff 100644
--- a/lib/uniara_virtual_parser/services/absences.rb
+++ b/lib/uniara_virtual_parser/services/absences.rb
@@ -1,7 +1,7 @@
 module UniaraVirtualParser
 	module Services
 		module Absences
-		def Absences(token)
+		def absences(token)
 			response = Client.get_with_token('/alunos/consultas/faltas',token)
 			parse_absences response.body
 		end
@@ -13,7 +13,7 @@ module UniaraVirtualParser
 			absences = []
 			subjects = []
 			
-			doc.css('div#conteudo ^table tr').each_with_index do |absence,index|
+			doc.css('div#conteudo ~table tr').each_with_index do |absence,index|
 				next if index.zero?
 				absences = Models::Absence.new(
 					frequency: 		absence.css('td:nth-child(2)').text,
@@ -26,4 +26,3 @@ module UniaraVirtualParser
 		end
 	end
 end
-
diff --git a/spec/uniara_virtual_parser/services/.grades_spec.rb.swp b/spec/uniara_virtual_parser/services/.grades_spec.rb.swp
deleted file mode 100644
index 96fee7d686ac8f2a7c332efb3b9775a072b2cc6e..0000000000000000000000000000000000000000
GIT binary patch
literal 0
HcmV?d00001

literal 12288
zcmeI2F>ljQ5XWE3T&RGZBORPb!A?shq)1eXN`)ekrlK?>(X)MtEjhOP-gDZjDiW$h
zg_szb5i?(aEju$4Gw>zg96NyyRLta_^nbQ>=eu{m(f+%QUb_Pi>`g&yRfx$~>^)z8
zB37>nk;S1@G7nt6#-n@xl=`B`awaboO7IbklCF$`#A&4|989}8MNWSlDwD~mpGu`s
zIXXq}Zy{9U&_nGEmGn{f^Hf{8S09<9Oke>Ctcd#?>y5R_UAT4gU;*dnk(mG!U;<2l
z2`~XBzyz4UViPdwlK4pomPxlsOQq<-iwQ6RCcp%k025#WOn?b60Vco%m;e*_PY6g~
zh_w|VE=c+R|NI-kj~haKCw(S;B7GpeChd{7NZ+mtaZWlSjY)S%U+Ddhr1zwEq_?Cu
zq`dAc5-%pe1egF5U;<2l2`~XBzyz286POaf*cSlB{`>mp-Q|0FIwqg9sTQVZJHmKq
zf|_j-z(ZKyq++vmIdKpwZR}W%aF$$YJ?gY~+xyR+wk8*o^DgYb&USaV+iABd^D?0U
zYk<ZJP=g5&yd*Xl8%PFF7`CA_Y=ew_a8(!&i$tlEJb|Oo1W+8+0zVP+y0eLAhc!uG
zp~+NSZE7P;rs3fhY&05ma1;NeSvH%y!w2CpC1bTxVhGGAs?=<<m-}@HXh)@+aC%mo
zHw4fobE(N;hT2q{Lo{`$1jeLI$0=v9i;-+E8QHFKWR%5;c4%asMMi2TPV$}l%&WRM
zNEGIi%?61uFFtjo*Wi@Q?%GqKi+<mWq}Fy30n3$UBx4KC$`@yOV3jFTTzS!X<ngp<
q(QB0WS%k1(THr<bTv+LQg@t}^>Yx`QA33B$TDd{KA7GTCvcxat(hm3l

diff --git a/spec/uniara_virtual_parser/services/absences_spec.rb b/spec/uniara_virtual_parser/services/absences_spec.rb
index 7e0b03f..d188983 100644
--- a/spec/uniara_virtual_parser/services/absences_spec.rb
+++ b/spec/uniara_virtual_parser/services/absences_spec.rb
@@ -1,17 +1,19 @@
 require 'spec_helper'
+require 'pry'
 
 module UniaraVirtualParser
   module Services
     describe Absences do
-      describe '.absences' do
-        let(:absences) { described_class.absences 'batman' }
+      describe '.subject' do
+        let(:subject) { described_class.absences 'batman' }
         before do
-          stub_request(:get,"http://virtual.uniara.com.br/alunos/consultas/faltas/").
-            to_return (status: => 200, body: uniara_virtual_fixture("absences.html").read, headers:{})
+          stub_request(:get,"http://virtual.uniara.com.br/alunos/consultas/faltas").
+            to_return(status: 200, body: uniara_virtual_fixture("absences.html").read, headers:{})
         end
         it 'fetches the content of uniara virtual and brings the array with absences' do
-          expect (absences.first.frequency).to eq "100%"
-          expect(absences.length).to eq 14
+          binding.pry
+          expect(absences.first.absences.frequency).to eq "100%"
+          expect(subject.length).to eq 14
         end
       end
     end
-- 
2.1.4

